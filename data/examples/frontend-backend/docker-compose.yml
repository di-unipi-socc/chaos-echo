version: '3.7'

# Simple application with a publicly available frontend connecting to a backend
# (frontend accessible at host's port 8080)

services: 
        frontend:
                image: diunipisocc/chaosecho:1
                environment:
                        BACKEND_SERVICES: "backend"
                        TIMEOUT: 10000
                        PICK_PERCENTAGE: 100
                        FAIL_PERCENTAGE: 20
                depends_on:
                        - backend
                ports:
                        - "8080:80"
        backend:
                image: diunipisocc/chaosecho:1
                environment:
                        TIMEOUT: 1000
                        PICK_PERCENTAGE: 50
                        FAIL_PERCENTAGE: 100
                deploy:
                        replicas: 2
                        restart_policy:
                                        condition: any
                                        delay: 5s
